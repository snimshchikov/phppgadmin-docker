#!/usr/bin/env sh
set -eu

PPA_SERVER_DESC=${PPA_SERVER_DESC:-PostgreSQL}
PPA_SERVER_HOST=${PPA_SERVER_HOST:-}
PPA_SERVER_PORT=${PPA_SERVER_PORT:-5432}
PPA_SERVER_SSL_MODE=${PPA_SERVER_SSL_MODE:-allow}
PPA_SERVER_DEFAULT_DB=${PPA_SERVER_DEFAULT_DB:-postgres}
PPA_SERVER_PG_DUMP_PATH=${PPA_SERVER_PG_DUMP_PATH:-/usr/bin/pg_dump}
PPA_SERVER_PG_DUMPALL_PATH=${PPA_SERVER_PG_DUMPALL_PATH:-/usr/bin/pg_dumpall}
PPA_SERVER_DESCS=${PPA_SERVER_DESCS:-}
PPA_SERVER_HOSTS=${PPA_SERVER_HOSTS:-}
PPA_SERVER_PORTS=${PPA_SERVER_PORTS:-}
PPA_SERVER_SSL_MODES=${PPA_SERVER_SSL_MODES:-}
PPA_SERVER_DEFAULT_DBS=${PPA_SERVER_DEFAULT_DBS:-}
PPA_SERVER_PG_DUMP_PATHS=${PPA_SERVER_PG_DUMP_PATHS:-}
PPA_SERVER_PG_DUMPALL_PATHS=${PPA_SERVER_PG_DUMPALL_PATHS:-}

PPA_DEFAULT_LANG=${PPA_DEFAULT_LANG:-auto}
PPA_AUTO_COMPLETE=${PPA_AUTO_COMPLETE:-'default on'}
PPA_EXTRA_LOGIN_SECURITY=${PPA_EXTRA_LOGIN_SECURITY:-true}
PPA_OWNED_ONLY=${PPA_OWNED_ONLY:-false}
PPA_SHOW_COMMENTS=${PPA_SHOW_COMMENTS:-true}
PPA_SHOW_ADVANCED=${PPA_SHOW_ADVANCED:-false}
PPA_SHOW_SYSTEM=${PPA_SHOW_SYSTEM:-false}
PPA_MIN_PASSWORD_LENGTH=${PPA_MIN_PASSWORD_LENGTH:-1}
PPA_LEFT_WIDTH=${PPA_LEFT_WIDTH:-200}
PPA_THEME=${PPA_THEME:-default}
PPA_SHOW_OIDS=${PPA_SHOW_OIDS:-false}
PPA_MAX_ROWS=${PPA_MAX_ROWS:-30}
PPA_MAX_CHARS=${PPA_MAX_CHARS:-50}
PPA_USE_XHTML_STRICT=${PPA_USE_XHTML_STRICT:-false}
PPA_HELP_BASE=${PPA_HELP_BASE:-'http://www.postgresql.org/docs/%s/interactive/'}
PPA_AJAX_REFRESH=${PPA_AJAX_REFRESH:-3}


cat ${CONTENT_DIR}/runtime/configs/phppgadmin/config.inc.php | \
    sed -e "s#{{PPA_SERVER_DESC}}#$PPA_SERVER_DESC#g" \
        -e "s#{{PPA_SERVER_HOST}}#$PPA_SERVER_HOST#g" \
        -e "s#{{PPA_SERVER_PORT}}#$PPA_SERVER_PORT#g" \
        -e "s#{{PPA_SERVER_SSL_MODE}}#$PPA_SERVER_SSL_MODE#g" \
        -e "s#{{PPA_SERVER_DEFAULT_DB}}#$PPA_SERVER_DEFAULT_DB#g" \
        -e "s#{{PPA_SERVER_PG_DUMP_PATH}}#$PPA_SERVER_PG_DUMP_PATH#g" \
        -e "s#{{PPA_SERVER_PG_DUMPALL_PATH}}#$PPA_SERVER_PG_DUMPALL_PATH#g" \
        "s#{{PPA_SERVER_DESCS}}#$PPA_SERVER_DESCS#g" \
        -e "s#{{PPA_SERVER_HOSTS}}#$PPA_SERVER_HOSTS#g" \
        -e "s#{{PPA_SERVER_PORTS}}#$PPA_SERVER_PORTS#g" \
        -e "s#{{PPA_SERVER_SSL_MODES}}#$PPA_SERVER_SSL_MODES#g" \
        -e "s#{{PPA_SERVER_DEFAULT_DBS}}#$PPA_SERVER_DEFAULT_DBS#g" \
        -e "s#{{PPA_SERVER_PG_DUMP_PATHS}}#$PPA_SERVER_PG_DUMP_PATHS#g" \
        -e "s#{{PPA_SERVER_PG_DUMPALL_PATHS}}#$PPA_SERVER_PG_DUMPALL_PATHS#g" \
        -e "s#{{PPA_DEFAULT_LANG}}#$PPA_DEFAULT_LANG#g" \
        -e "s#{{PPA_AUTO_COMPLETE}}#$PPA_AUTO_COMPLETE#g" \
        -e "s#{{PPA_EXTRA_LOGIN_SECURITY}}#$PPA_EXTRA_LOGIN_SECURITY#g" \
        -e "s#{{PPA_OWNED_ONLY}}#$PPA_OWNED_ONLY#g" \
        -e "s#{{PPA_SHOW_COMMENTS}}#$PPA_SHOW_COMMENTS#g" \
        -e "s#{{PPA_SHOW_ADVANCED}}#$PPA_SHOW_ADVANCED#g" \
        -e "s#{{PPA_SHOW_SYSTEM}}#$PPA_SHOW_SYSTEM#g" \
        -e "s#{{PPA_MIN_PASSWORD_LENGTH}}#$PPA_MIN_PASSWORD_LENGTH#g" \
        -e "s#{{PPA_LEFT_WIDTH}}#$PPA_LEFT_WIDTH#g" \
        -e "s#{{PPA_THEME}}#$PPA_THEME#g" \
        -e "s#{{PPA_SHOW_OIDS}}#$PPA_SHOW_OIDS#g" \
        -e "s#{{PPA_MAX_ROWS}}#$PPA_MAX_ROWS#g" \
        -e "s#{{PPA_MAX_CHARS}}#$PPA_MAX_CHARS#g" \
        -e "s#{{PPA_USE_XHTML_STRICT}}#$PPA_USE_XHTML_STRICT#g" \
        -e "s#{{PPA_HELP_BASE}}#$PPA_HELP_BASE#g" \
        -e "s#{{PPA_AJAX_REFRESH}}#$PPA_AJAX_REFRESH#g" \
        > ${WEBROOT_DIR}/conf/config.inc.php
